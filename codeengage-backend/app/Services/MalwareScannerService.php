<?php

namespace App\Services;

class MalwareScannerService
{
    private array $suspiciousPatterns = [
        '/eval\s*\(/i',
        '/base64_decode\s*\(/i',
        '/exec\s*\(/i',
        '/system\s*\(/i',
        '/passthru\s*\(/i',
        '/shell_exec\s*\(/i',
        '/popen\s*\(/i',
        '/proc_open\s*\(/i',
        '/pcntl_exec\s*\(/i',
        '/python_eval\s*\(/i',
        '/create_function\s*\(/i',
        '/include\s*[\'"](http|ftp|php|data):/i',
        '/require\s*[\'"](http|ftp|php|data):/i'
    ];

    /**
     * Scan code for potentially malicious patterns
     * 
     * @param string $code
     * @return array [bool $isSafe, array $matches]
     */
    public function scan(string $code): array
    {
        $matches = [];
        $isSafe = true;

        foreach ($this->suspiciousPatterns as $pattern) {
            if (preg_match($pattern, $code, $match)) {
                $isSafe = false;
                $matches[] = $match[0];
            }
        }

        return [
            'is_safe' => $isSafe,
            'matches' => $matches
        ];
    }
}
